
[request_definition]
r = person_id, action, item, item_id

# action = r,w,all or d (d permission is not in the database)

[policy_definition]
p = person_id, perm, item, entity_id

[policy_effect]
e = some(where (p.eft == allow))

[matchers]
# doc. in chimitheque_utils/src/casbin.rs
m = ( (r.person_id == p.person_id) && ( (p.perm == "all" && p.item == "all" && p.entity_id == "-1") || (r.action == p.perm || (r.action == "r" && (p.perm == "w" || p.perm == "all")) || ((r.action == "w" || r.action == "d") && p.perm == "all") || (r.action == "all" && p.perm == "all")) ) && ( (r.item == "userinfo") || (r.item == "ping") || ( ((r.item == "bookmarks" || r.item == "download" || r.item == "validate") && (p.item == "products" || p.item =="all")) || (r.item == "products" && r.action == "d" && ! matchProductHasStorages(r.item_id)) || (r.item == "products" && (r.action == "r" || r.action == "w") && (p.item == "products" || p.item =="all")) || (r.item == "entities" && r.action == "r" && r.item_id == "" && (p.item == "entities" || p.item =="all")) || (r.item == "entities" && r.action == "r" && r.item_id != "" && matchPersonIsInEntity(r.person_id, r.item_id)) || (r.item == "entities" && r.action == "w" && r.item_id == "" && (p.perm == "all" && p.item == "all" && p.entity_id == "-1")) || (r.item == "entities" && r.action == "d" && r.item_id != "" && (p.perm == "all" && p.item == "all" && p.entity_id == "-1") && ! matchEntityHasMembers(r.item_id) && ! matchEntityHasStoreLocations(r.item_id)) || (r.item == "entities" && (r.action == "w") && r.item_id == p.entity_id && (p.item == "entities" || p.item =="all")) || ((r.item == "storages" || r.item == "stocks" || r.item == "borrows") && r.item_id == "" && (p.item == "storages" || p.item =="all")) || ((r.item == "storages" || r.item == "stocks" || r.item == "borrows") && r.item_id != "" && matchPersonIsInStorageEntity(r.person_id, r.item_id, p.entity_id)) || (r.item == "store_locations" && r.action == "r" && r.item_id == "" && (p.item == "storages" || p.item =="all")) || (r.item == "store_locations" && r.action == "r" && r.item_id != "" && matchPersonIsInStoreLocationEntity(r.person_id, r.item_id, p.entity_id)) || (r.item == "store_locations" && r.action == "d" && r.item_id != "" && (p.item == "entities" || p.item =="all") && ! matchStoreLocationHasChildren(r.item_id) && ! matchStoreLocationHasStorages(r.item_id)) || (r.item == "store_locations" && (r.action == "w" || r.action == "d") && r.item_id == "" && (p.item == "entities" || p.item =="all")) || (r.item == "store_locations" && (r.action == "w" || r.action == "d") && r.item_id != "" && matchPersonIsInStoreLocationEntity(r.person_id, r.item_id, p.entity_id)) ||  (r.item == "people" && r.action == "r" && r.item_id == "" && (p.item == "entities" || p.item =="all")) || (r.item == "people" && r.action == "r" && r.item_id != p.person_id && r.item_id != "" && matchPersonIsInPersonEntity(r.person_id, r.item_id, p.entity_id)) || (r.item == "people" && r.action == "d" && r.item_id != "" && (p.item == "entities" || p.item =="all") && r.item_id != p.person_id && ! matchPersonIsAdmin(r.person_id) && ! matchPersonIsManager(r.person_id)) || (r.item == "people" && (r.action == "w" || r.action == "d") && r.item_id == "" && (p.item == "entities" || p.item =="all")) || (r.item == "people" && (r.action == "w" || r.action == "d") && r.item_id != p.person_id && r.item_id != "" && matchPersonIsInPersonEntity(r.person_id, r.item_id)) ) ) )
